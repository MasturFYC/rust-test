import{n as h,b as l,R as c,c as d}from"./Close.40a54a06.js";class f{constructor(t){this.options=Object.assign(Object.assign({},t.defaultOptions),t.options),this.mutationId=t.mutationId,this.mutationCache=t.mutationCache,this.observers=[],this.state=t.state||v(),this.meta=t.meta}setState(t){this.dispatch({type:"setState",state:t})}addObserver(t){this.observers.indexOf(t)===-1&&this.observers.push(t)}removeObserver(t){this.observers=this.observers.filter(n=>n!==t)}cancel(){return this.retryer?(this.retryer.cancel(),this.retryer.promise.then(h).catch(h)):Promise.resolve()}continue(){return this.retryer?(this.retryer.continue(),this.retryer.promise):this.execute()}execute(){let t;const n=this.state.status==="loading";let u=Promise.resolve();return n||(this.dispatch({type:"loading",variables:this.options.variables}),u=u.then(()=>{var e,s;(s=(e=this.mutationCache.config).onMutate)===null||s===void 0||s.call(e,this.state.variables,this)}).then(()=>{var e,s;return(s=(e=this.options).onMutate)===null||s===void 0?void 0:s.call(e,this.state.variables)}).then(e=>{e!==this.state.context&&this.dispatch({type:"loading",context:e,variables:this.state.variables})})),u.then(()=>this.executeMutation()).then(e=>{var s,a;t=e,(a=(s=this.mutationCache.config).onSuccess)===null||a===void 0||a.call(s,t,this.state.variables,this.state.context,this)}).then(()=>{var e,s;return(s=(e=this.options).onSuccess)===null||s===void 0?void 0:s.call(e,t,this.state.variables,this.state.context)}).then(()=>{var e,s;return(s=(e=this.options).onSettled)===null||s===void 0?void 0:s.call(e,t,null,this.state.variables,this.state.context)}).then(()=>(this.dispatch({type:"success",data:t}),t)).catch(e=>{var s,a;return(a=(s=this.mutationCache.config).onError)===null||a===void 0||a.call(s,e,this.state.variables,this.state.context,this),l().error(e),Promise.resolve().then(()=>{var o,r;return(r=(o=this.options).onError)===null||r===void 0?void 0:r.call(o,e,this.state.variables,this.state.context)}).then(()=>{var o,r;return(r=(o=this.options).onSettled)===null||r===void 0?void 0:r.call(o,void 0,e,this.state.variables,this.state.context)}).then(()=>{throw this.dispatch({type:"error",error:e}),e})})}executeMutation(){var t;return this.retryer=new c({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:()=>{this.dispatch({type:"failed"})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(t=this.options.retry)!==null&&t!==void 0?t:0,retryDelay:this.options.retryDelay}),this.retryer.promise}dispatch(t){this.state=b(this.state,t),d.batch(()=>{this.observers.forEach(n=>{n.onMutationUpdate(t)}),this.mutationCache.notify(this)})}}function v(){return{context:void 0,data:void 0,error:null,failureCount:0,isPaused:!1,status:"idle",variables:void 0}}function b(i,t){switch(t.type){case"failed":return Object.assign(Object.assign({},i),{failureCount:i.failureCount+1});case"pause":return Object.assign(Object.assign({},i),{isPaused:!0});case"continue":return Object.assign(Object.assign({},i),{isPaused:!1});case"loading":return Object.assign(Object.assign({},i),{context:t.context,data:void 0,error:null,isPaused:!1,status:"loading",variables:t.variables});case"success":return Object.assign(Object.assign({},i),{data:t.data,error:null,status:"success",isPaused:!1});case"error":return Object.assign(Object.assign({},i),{data:void 0,error:t.error,failureCount:i.failureCount+1,isPaused:!1,status:"error"});case"setState":return Object.assign(Object.assign({},i),t.state);default:return i}}export{f as M,v as g};
