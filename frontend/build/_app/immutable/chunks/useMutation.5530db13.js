import{r as O}from"./index.204e47e8.js";import{S as v,c as p,x as b,n as R}from"./Close.40a54a06.js";import{g}from"./mutation.80cc1b8d.js";import{u as M}from"./Delete.463ddbcb.js";class y extends v{constructor(t,s){super(),this.client=t,this.setOptions(s),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){this.options=this.client.defaultMutationOptions(t)}onUnsubscribe(){var t;this.listeners.length||(t=this.currentMutation)===null||t===void 0||t.removeObserver(this)}onMutationUpdate(t){this.updateResult();const s={listeners:!0};t.type==="success"?s.onSuccess=!0:t.type==="error"&&(s.onError=!0),this.notify(s)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,s){return this.mutateOptions=s,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,Object.assign(Object.assign({},this.options),{variables:typeof t<"u"?t:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:g(),s=Object.assign(Object.assign({},t),{isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=s}notify(t){p.batch(()=>{var s,r,c,e,u,i,l,a;this.mutateOptions&&(t.onSuccess?((r=(s=this.mutateOptions).onSuccess)===null||r===void 0||r.call(s,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(e=(c=this.mutateOptions).onSettled)===null||e===void 0||e.call(c,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)):t.onError&&((i=(u=this.mutateOptions).onError)===null||i===void 0||i.call(u,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(a=(l=this.mutateOptions).onSettled)===null||a===void 0||a.call(l,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context))),t.listeners&&this.listeners.forEach(h=>{h(this.currentResult)})})}}function C(d,t,s){const r=b(d,t,s),c=M(),e=new y(c,r),u=(o,n)=>{e.mutate(o,n).catch(R)},i=e.getCurrentResult(),l=Object.assign(Object.assign({},i),{mutate:u,mutateAsync:i.mutate}),{subscribe:a}=O(l,o=>e.subscribe(p.batchCalls(n=>{e.hasListeners()&&o(Object.assign(Object.assign({},n),{mutate:u,mutateAsync:n.mutate}))})));function h(o,n,f){if(e.hasListeners()){const m=b(o,n,f);e.setOptions(m)}}return{subscribe:a,setOptions:h}}export{C as u};
